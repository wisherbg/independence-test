<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Въпросник: Готов ли си за следващата стъпка?</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; background-color: #f4f7f6; color: #333; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        h1, h2 { color: #2c3e50; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px; }
        .question-group { margin-bottom: 30px; }
        label { font-weight: bold; display: block; margin-bottom: 8px; color: #34495e; font-size: 1.1em; }
        textarea { width: 100%; padding: 12px; border-radius: 6px; border: 1px solid #ccc; font-size: 16px; min-height: 80px; box-sizing: border-box; resize: vertical; transition: background-color 0.3s ease; }
        /* Стил за заключените полета */
        textarea:read-only {
            background-color: #f0f0f0;
            color: #555;
            cursor: not-allowed;
        }
        .submit-btn { display: block; width: 100%; padding: 15px; background-color: #3498db; color: white; border: none; border-radius: 6px; font-size: 18px; cursor: pointer; transition: background-color 0.3s; margin-top: 20px; }
        .submit-btn:hover { background-color: #2980b9; }
        .submit-btn:disabled { background-color: #a9a9a9; cursor: not-allowed; }
        .result-box { margin-top: 30px; padding: 25px; border-radius: 8px; background-color: #fafafa; border-left: 5px solid #3498db; white-space: pre-wrap; display: none; }
        .loading { text-align: center; font-style: italic; color: #7f8c8d; }
    </style>
</head>
<body>

<div class="container">
    <h1>Въпросник: Готов ли си за следващата стъпка?</h1>
    <p>Отговори на въпросите със свои думи. Няма правилни или грешни отговори. Целта е да помислиш честно за тези ситуации.</p>

    <form id="quizForm">
        <h2>1. Финансова Отговорност</h2>
        <div class="question-group">
            <label for="q1">1. Представи си, че започваш работа и получаваш първата си заплата. Какво правиш с парите?</label>
            <textarea id="q1" name="q1" required></textarea>
        </div>
        <div class="question-group">
            <label for="q2">2. При размисъл върху възможността да се издържаш сам, колко пари смяташ, че са ти нужни месечно, за да живееш?</label>
            <textarea id="q2" name="q2" required></textarea>
        </div>
        <div class="question-group">
            <label for="q3">3. Имаш нужда от нов лаптоп за следващата година. Как планираш да го купиш?</label>
            <textarea id="q3" name="q3" required></textarea>
        </div>
        <div class="question-group">
            <label for="q4">4. Имаш нужда да платиш онлайн сметка за наем или комунални услуги. Как го правиш?</label>
            <textarea id="q4" name="q4" required></textarea>
        </div>

        <h2>2. Управление на Домакинството</h2>
        <div class="question-group">
            <label for="q5">5. Представи си, че живееш под наем и бойлерът се разваля. Какво правиш?</label>
            <textarea id="q5" name="q5" required></textarea>
        </div>
        <div class="question-group">
            <label for="q6">6. Живееш сам и в апартамента ти се налага основно почистване. Какво е твоето отношение?</label>
            <textarea id="q6" name="q6" required></textarea>
        </div>
        <div class="question-group">
            <label for="q7">7. Вкъщи храната е на привършване. Какво правиш?</label>
            <textarea id="q7" name="q7" required></textarea>
        </div>
        <div class="question-group">
            <label for="q8">8. Трябва да изпереш дрехи, но не знаеш как точно. Какво правиш?</label>
            <textarea id="q8" name="q8" required></textarea>
        </div>

        <h2>3. Здраве и Лични Грижи</h2>
        <div class="question-group">
            <label for="q9">9. Събуждаш се с много силно главоболие и не можеш да станеш от леглото. Какво правиш?</label>
            <textarea id="q9" name="q9" required></textarea>
        </div>
        <div class="question-group">
            <label for="q10">10. Предстои ти важно събитие, но се чувстваш твърде изморен и стресиран. Какво е твоето решение?</label>
            <textarea id="q10" name="q10" required></textarea>
        </div>
        <div class="question-group">
            <label for="q11">11. Забелязваш, че си се чувствал много тъжен през последните две седмици, без конкретна причина. Какво правиш?</label>
            <textarea id="q11" name="q11" required></textarea>
        </div>
        <div class="question-group">
            <label for="q12">12. Записваш се на фитнес, за да се грижиш за себе си. Какво правиш, когато срещнеш първите трудности?</label>
            <textarea id="q12" name="q12" required></textarea>
        </div>
        
        <h2>4. Емоционална Зрялост и Решаване на Проблеми</h2>
        <div class="question-group">
            <label for="q13">13. Родителите ти казват, че не са съгласни с решението ти за gap year и смятат, че е грешно. Как реагираш?</label>
            <textarea id="q13" name="q13" required></textarea>
        </div>
        <div class="question-group">
            <label for="q14">14. Имаш конфликт с колега на работа, докато работите по общ проект. Как решаваш проблема?</label>
            <textarea id="q14" name="q14" required></textarea>
        </div>
        <div class="question-group">
            <label for="q15">15. Искаш да обсъдиш с родителите си възможността да заминеш в чужбина за няколко месеца. Как го правиш?</label>
            <textarea id="q15" name="q15" required></textarea>
        </div>
        <div class="question-group">
            <label for="q16">16. Насрочил си си важна среща, но изведнъж разбираш, че ще закъснееш. Какво правиш?</label>
            <textarea id="q16" name="q16" required></textarea>
        </div>
        
        <button type="submit" class="submit-btn" id="submitButton">Получи своя анализ</button>
    </form>

    <div id="result" class="result-box">
        <h2 id="result-heading">Твоят персонален анализ:</h2>
        <div id="result-text"></div>
    </div>
</div>

<script>
    document.getElementById('quizForm').addEventListener('submit', async function(event) {
        event.preventDefault();

        const submitButton = document.getElementById('submitButton');
        const resultBox = document.getElementById('result');
        const resultText = document.getElementById('result-text');
        const resultHeading = document.getElementById('result-heading');
        
        const answers = {};
        for(let i = 1; i <= 16; i++) {
            const answer = document.getElementById('q' + i).value;
            if (!answer) {
                alert('Моля, отговори на всички въпроси.');
                return;
            }
            answers['q' + i] = answer;
        }

        // --- НОВ КОД: Заключваме полетата ---
        for(let i = 1; i <= 16; i++) {
            document.getElementById('q' + i).readOnly = true;
        }
        // --- Край на новия код ---

        submitButton.disabled = true;
        submitButton.textContent = 'Анализирам...';
        resultBox.style.display = 'block';
        resultText.innerHTML = '<p class="loading">Моля, изчакайте. Вашият анализ се генерира...</p>';
        resultHeading.textContent = "Анализ в процес на подготовка...";

        try {
            const response = await fetch('/api/analyze', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ answers: answers }),
            });

            if (!response.ok) { throw new Error('Грешка при комуникацията със сървъра.'); }

            const data = await response.json();
            resultHeading.textContent = "Твоят персонален анализ:";
            resultText.textContent = data.analysis;

        } catch (error) {
            resultText.textContent = 'Възникна грешка. Моля, опитайте отново по-късно.';
            console.error('Error:', error);
        }
        // Бутонът остава заключен, за да не може да се пуска анализ повторно
    });
</script>

</body>
</html>